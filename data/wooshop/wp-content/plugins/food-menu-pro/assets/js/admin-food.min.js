!function(e){"use strict";function t(){"variable"===e("select#_fmp_type").val()?(e(".simple_menu_attr").hide(),e(".variation-wrapper").show()):(e(".simple_menu_attr").show(),e(".variation-wrapper").hide())}e("ul.fmp-tabs").show(),e("ul.fmp-tabs").on("click","a",(function(t){t.preventDefault();var i=e(this).closest("div.panel-wrapper");e("ul.fmp-tabs li",i).removeClass("active"),e(this).parent().addClass("active"),e("div.panel",i).hide(),e(e(this).attr("href")).show()})),e("div.panel-wrapper").each((function(){e(this).find("ul.fmp-tabs li").eq(0).find("a").click()})),t(),e("select#_fmp_type").change((function(e){t()})),e(".fmp-metabox.closed").each((function(){e(this).find(".fmp-metabox-content").hide()})),e(".fmp_variations").on("blur","input.variation_name",(function(){e(this).closest(".fmp_variation").find("strong.variation_name").text(e(this).val())})),e(".fmp-metaboxes-wrapper").on("click",".fmp-metabox > h3",(function(){var t=e(this).parent(".fmp-metabox");t.hasClass("closed")?t.find(".fmp-metabox-content").slideDown("slow"):t.find(".fmp-metabox-content").slideUp("slow"),t.toggleClass("closed").toggleClass("open")}));var i=e(".fmp_variations"),a=function(){i.addClass("fmp_loading"),e('<div class="fmp-pre-loader"><span class="spinner is-active"></span>').appendTo(i)},n=function(){i.removeClass("fmp_loading"),i.find(".fmp-pre-loader").remove()};e("button.add_variation").on("click",(function(){var t=e(".fmp_variations .fmp_variation").length,i=e(this).closest("#general_fmp_data").find(".fmp_variations"),r={action:"fmp_add_variation_action",parent_id:e("#post_ID").val(),i:t,nonceID:fmp_var.nonce};e.ajax({type:"POST",url:fmp_var.ajaxurl,data:r,beforeSend:function(){a()},success:function(e){i.append(e),n()},error:function(e){n()}})})),e(document).on("click",".fmp_variation .remove_row",(function(t){if(t.preventDefault(),confirm("Are you sure to delete!!")){var i=e(this).attr("data-id"),r=e(this).parents(".fmp_variation"),o={post_id:i,action:"fmp_remove_variation_action"};e.ajax({type:"POST",url:fmp_var.ajaxurl,data:o,beforeSend:function(){a()},success:function(t){t.error||r.slideUp("slow",(function(){e(this).remove()})),n()},error:function(){n()}})}return!1})),e("button.save_variations").on("click",(function(){var t={data:e(".fmp_variations").find("input").serialize(),action:"fmp_save_variations_action"};return e.ajax({type:"POST",url:fmp_var.ajaxurl,data:t,beforeSend:function(){a()},success:function(e){n()},error:function(e){n()}}),!1}));var r,o={decimal_error:"Please enter in decimal (.) format without thousand separators.",mon_decimal_error:"Please enter in monetary decimal (.) format without thousand separators and currency symbols.",country_iso_error:"Please enter in country code with two capital letters.",sale_less_than_regular_error:"Please enter in a value less than the regular price.",decimal_point:".",mon_decimal_point:"."};e(document.body).on("fmp_add_error_tip",(function(t,i,a){var n=i.position();0===i.parent().find(".fmp_error_tip").length&&(i.after('<div class="fmp_error_tip '+a+'">'+o[a]+"</div>"),i.parent().find(".fmp_error_tip").css("left",n.left+i.width()-i.width()/2-e(".fmp_error_tip").width()/2).css("top",n.top+i.height()).fadeIn("100"))})).on("fmp_remove_error_tip",(function(t,i,a){i.parent().find(".fmp_error_tip."+a).fadeOut("100",(function(){e(this).remove()}))})).on("blur",".fmp_input_price[type=text]",(function(){e(".fmp_error_tip").fadeOut("100",(function(){e(this).remove()}))})).on("change",".fmp_input_price[type=text]",(function(){var t;t=e(this).is(".fmp_input_price")?new RegExp("[^-0-9%\\"+o.mon_decimal_point+"]+","gi"):new RegExp("[^-0-9%\\"+o.decimal_point+"]+","gi");var i=e(this).val(),a=i.replace(t,"");i!==a&&e(this).val(a)})).on("keyup",".fmp_input_price[type=text]",(function(){var t,i;e(this).is(".fmp_input_price")?(t=new RegExp("[^-0-9%\\"+o.mon_decimal_point+"]+","gi"),i="mon_decimal_error"):e(this).is(".fmp_input_country_iso")?(t=new RegExp("([^A-Z])+|(.){3,}","im"),i="country_iso_error"):(t=new RegExp("[^-0-9%\\"+o.decimal_point+"]+","gi"),i="decimal_error");var a=e(this).val(),n=a.replace(t,"");a!==n?e(document.body).triggerHandler("fmp_add_error_tip",[e(this),i]):e(document.body).triggerHandler("fmp_remove_error_tip",[e(this),i])})).on("change","#_sale_price.fmp_input_price[type=text]",(function(){var t=e(this),i=e("#_regular_price");parseFloat(window.accounting.unformat(t.val(),o.mon_decimal_point))>=parseFloat(window.accounting.unformat(i.val(),o.mon_decimal_point))&&e(this).val("")})).on("keyup","#_sale_price.fmp_input_price[type=text]",(function(){var t=e(this),i=e("#_regular_price");parseFloat(window.accounting.unformat(t.val(),o.mon_decimal_point))>=parseFloat(window.accounting.unformat(i.val(),o.mon_decimal_point))?e(document.body).triggerHandler("fmp_add_error_tip",[e(this),"sale_less_than_regular_error"]):e(document.body).triggerHandler("fmp_remove_error_tip",[e(this),"sale_less_than_regular_error"])})).on("keyup",".fmp-item-search input[type=text]",(function(){var t=e(this),i=t.parents("ul.fmp-available-list").find("li.available-item"),a=new RegExp(t.val(),"gi");a?i.each((function(){var t=e(this);t.find("label").text().match(a)?t.show():t.hide()})):item.show()})),e("#ingredient-container .fmp-sortable-list").sortable({connectWith:".fmp-sortable-list",update:function(t,i){var a=e(this),n=e(i.item);if(a.hasClass("fmp-active-list")){if(n.find("input").length<1){var r=n.data("id"),o=fmp_var.units,l="";o&&e.map(o,(function(e,t){l=l+"<option value='"+t+"'>"+e+"</option>"}));var s="<input type='text' name='_ingredient["+r+"][value]'><select name='_ingredient["+r+"][unit_id]'><option value=''>Unit</option>"+l+"</select>";n.find(".fmp-sortable-item-values").html(s),n.removeClass("available-item").addClass("active-item")}}else n.find(".fmp-sortable-item-values").html(""),n.removeClass("active-item").addClass("available-item")}}).disableSelection(),e("#nutrition-container .fmp-sortable-list").sortable({connectWith:".fmp-sortable-list",update:function(t,i){var a=e(this),n=e(i.item);if(a.hasClass("fmp-active-list")){if(n.find("input").length<1){var r=n.data("id"),o=fmp_var.units,l="";o&&e.map(o,(function(e,t){l=l+"<option value='"+t+"'>"+e+"</option>"}));var s="<input type='text' name='_nutrition["+r+"][value]'><select name='_nutrition["+r+"][unit_id]'><option value=''>Unit</option>"+l+"</select>";n.find(".fmp-sortable-item-values").html(s),n.removeClass("available-item").addClass("active-item")}}else n.find(".fmp-sortable-item-values").html(""),n.removeClass("active-item").addClass("available-item")}}).disableSelection(),e(".post-type-food-menu table.posts #the-list").length&&e(".post-type-food-menu table.posts #the-list").sortable({items:"tr",axis:"y",helper:function(t,i){return i.children().children().each((function(){e(this).width(e(this).width())})),i},placeholder:"placeholder",opacity:.65,update:function(t,i){var a=e("#the-list").sortable("serialize");jQuery.ajax({type:"post",url:ajaxurl,data:a+"&action=fmp-logo-update-menu-order",beforeSend:function(){e("body").append(e("<div id='fmp-loading'><span class='fmp-loading'>Updating ...</span></div>"))},success:function(e){jQuery("#fmp-loading").remove()}})}});var l=e("#fmp_image_gallery"),s=e("#fmp_images_container").find("ul.fmp_images");e(".add_fmp_images").on("click","a",(function(t){var i=e(this);t.preventDefault(),r||(r=wp.media.frames.product_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]})).on("select",(function(){var e=r.state().get("selection"),t=l.val();e.map((function(e){if((e=e.toJSON()).id){t=t?t+","+e.id:e.id;var a=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;s.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+a+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}})),l.val(t)})),r.open()})),s.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"fmp-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";e("#fmp_images_container").find("ul li.image").css("cursor","default").each((function(){var i=e(this).attr("data-attachment_id");t=t+i+","})),l.val(t)}}),e("#fmp_images_container").on("click","a.delete",(function(){e(this).closest("li.image").remove();var t="";return e("#fmp_images_container").find("ul li.image").css("cursor","default").each((function(){var i=e(this).attr("data-attachment_id");t=t+i+","})),l.val(t),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),!1}))}(jQuery);